<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <title>Neon Arcade – logowanie</title>

    <link rel="stylesheet" href="css/theme.css" />

    <script
      src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"
      defer
    ></script>
    <script src="js/core/auth.js" defer></script>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        // jeśli user jest zalogowany → od razu do arcade
        if (window.ArcadeAuth && ArcadeAuth.getUser) {
          const user = await ArcadeAuth.getUser();
          if (user) {
            window.location.href = "arcade.html";
            return;
          }
        }

        const email = document.querySelector(".auth-email");
        const pass = document.querySelector(".auth-pass");
        const pass2 = document.querySelector(".auth-pass2");
        const status = document.querySelector(".auth-status");
        const error = document.querySelector(".auth-error");
        const btnLogin = document.querySelector(".auth-login");
        const btnRegister = document.querySelector(".auth-register");
        const btnGuest = document.querySelector(".auth-guest");
        const btnLogout = document.querySelector(".auth-logout");
        const btnForgot = document.querySelector(".auth-forgot");

        if (window.ArcadeAuthUI && ArcadeAuthUI.initLoginPanel) {
          ArcadeAuthUI.initLoginPanel({
            email,
            pass,
            pass2,
            status,
            error,
            btnLogin,
            btnRegister,
            btnGuest,
            btnLogout,
            btnForgot,
            onLoginSuccess() {
              window.location.href = "arcade.html";
            },
            onRegisterSuccess() {
              // zostajemy tu, user musi kliknąć link aktywacyjny z maila
            },
            onLogout() {
              window.location.reload();
            },
            onGuest() {
              window.location.href = "arcade.html";
            },
          });
        }
      });

      // obsługa powrotu strzałką – przy wejściu z cache też sprawdź
      window.addEventListener("pageshow", async (event) => {
        if (event.persisted) {
          if (window.ArcadeAuth && ArcadeAuth.getUser) {
            const user = await ArcadeAuth.getUser();
            if (user) {
              window.location.href = "arcade.html";
            }
          }
        }
      });
    </script>
  </head>
  <body class="arcade-body">
    <div class="shell">
      <div class="card">
        <header class="header">
          <div>
            <div class="title">NEON ARCADE</div>
            <div class="subtitle">Zaloguj się, aby grać.</div>
          </div>
        </header>

        <div class="auth-status" style="margin-bottom: 12px">
          Ładuję status...
        </div>

        <div class="auth-controls">
          <input
            type="email"
            class="auth-email arcade-input"
            placeholder="Email"
          />
          <input
            type="password"
            class="auth-pass arcade-input"
            placeholder="Hasło"
          />
          <input
            type="password"
            class="auth-pass2 arcade-input"
            placeholder="Powtórz hasło"
            style="display: none"
          />

          <div style="margin-top: 12px">
            <button class="arcade-btn auth-login">Zaloguj</button>
            <button class="arcade-btn auth-register">Załóż konto</button>
            <button class="arcade-btn auth-guest">Gość</button>
            <button class="arcade-btn auth-logout" style="display: none">
              Wyloguj
            </button>
          </div>

          <div style="margin-top: 8px">
            <span
              class="auth-forgot"
              style="cursor:pointer;font-size:11px;opacity:0.8;"
            >
              Przypomnij hasło
            </span>
            <span
              class="auth-error"
              style="margin-left:8px;font-size:11px;color:#fca5a5;"
            ></span>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
